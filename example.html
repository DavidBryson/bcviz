<html>
	<head>
		<meta charset="utf-8">
		<title>Bamcheck ex.1 - IC</title>
		<script src="http://d3js.org/d3.v3.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="myStyle.css">
		<script src="lineChart.js"></script>
		<script src="readIC.js"></script>
	</head>
	<body>
		<svg id="svg1"></svg>
		<svg id="svg2"></svg>
		<script>
			function readFile(fileName)
			{
				var contentsOfFileAsString = FileHelper.readStringFromFileAtPath(fileName);
				return d3.tsv.parseRows(contentsOfFileAsString);
			}

			function FileHelper()
			{}
			{
				FileHelper.readStringFromFileAtPath = function(fileName)
				{
					var request = new XMLHttpRequest();
					request.open("GET", fileName, false);
					request.send(null);
					var returnValue = request.responseText;

					return returnValue;
				}
			}
			function formatData (fileString) {
				var formattedData = [
					[
						{xLabel: "Cycle",
						yLabel: "Indel"},
						{
							name: "insertions_fwd",
							values: [
								
							]
						},
						{
							name: "deletions_fwd",
							values: [
								
							]
						},
						{
							name: "insertions_rev",
							values: [
								
							]
						},
						{
							name: "deletions_rev",
							values: [
								
							]
						}
					],
					[
						{xLabel: "Line Number",
						yLabel: "Pairs"},
						{
							name: "totalPairs",
							values: [
								
							]
						},
						{
							name: "inwardPairs",
							values: [
								
							]
						},
						{
							name: "outwardPairs",
							values: [
								
							]
						},
						{
							name: "otherPairs",
							values: [
								
							]
						}
					]
				]
				for (var i = 0; i < fileString.length; i++) {
					switch (fileString[i][0]){
						case "IC":
							formattedData[0][1].values.push({xVar: +fileString[i][1],yVar:+fileString[i][2]});
							formattedData[0][3].values.push({xVar: +fileString[i][1],yVar:+fileString[i][3]});
							formattedData[0][2].values.push({xVar: +fileString[i][1],yVar:+fileString[i][4]});
							formattedData[0][4].values.push({xVar: +fileString[i][1],yVar:+fileString[i][5]});
							break;
						case "IS":
							formattedData[1][1].values.push({xVar: +fileString[i][1],yVar:+fileString[i][2]});
							formattedData[1][2].values.push({xVar: +fileString[i][1],yVar:+fileString[i][3]});
							formattedData[1][3].values.push({xVar: +fileString[i][1],yVar:+fileString[i][4]});
							formattedData[1][4].values.push({xVar: +fileString[i][1],yVar:+fileString[i][5]});
							break;
					}


				};
				return formattedData;
			}
			var graphCount = 0;
			var split = false;
			var points = [];
			points.push(formatData(readFile("7843_2-1.bc")));
			points.push(formatData(readFile("7843_2-2.bc")));
			points.push(formatData(readFile("7843_2-3.bc")));
			points.push(formatData(readFile("7843_2-4.bc")));
			var keysIC = {
				all: ["insertions_fwd","deletions_fwd","insertions_rev","deletions_rev"],
				fwd: ["insertions_fwd","deletions_fwd"],
				reverse: ["insertions_rev","deletions_rev"]
			};
			newGraph();
			function toggleSplit () {
				if(split === true){
					split = false;
				}else{
					split = true;
				}
			}
			function newGraph () {
				lineChart(points[graphCount][0], '#svg1', keysIC.all);
			}
			function drawGraph () {
				$("#svg1").empty();
				$("#svg2").empty();
				if(graphCount >= points.length){
					graphCount = 0;
				}
				if(graphCount < 0){
					graphCount = points.length - 1;
				}
				if(split === true){
					splitGraphs(points[graphCount][0], '#svg1', keysIC.fwd, keysIC.reverse);
				}else{
					newGraph();
				}
			}
			//function splitGraphs () {
			//	lineChart(points[graphCount][0], '#svg1', keysIC.reverse);
			//	lineChart(points[graphCount][0], '#svg2', keysIC.fwd);
			//}
			$(window).keydown(function (e) {
				if(e.which == 188){
					graphCount--
					drawGraph();
				}
				if(e.which == 190){
					graphCount++
					drawGraph();
				}
				if(e.which == 13){
					toggleSplit();
					drawGraph();
				}
			})
		</script>
	</body>
</html>